@model FirstProjectNET.Models.ViewModel.AuthenticationViewModel
@{
	Layout = null;
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

<link rel="stylesheet" href="~/TemplateLayout/Login/css/style.css" />
<div class="container" id="container">
	<div class="form-container sign-up-container">
		<form method="post" asp-action="SignUp" asp-controller="Authentication" novalidate>
			<input type="hidden" asp-for="ReturnUrl" />
			<h1>Create Account</h1>
			<div class="social-container">
				<a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
				<a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
				<a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
			</div>
			<span>or use your email for registration</span>
			<input type="text" placeholder="Name" asp-for="SignUpUserName" />
			<span asp-validation-for="SignUpUserName" class="text-danger"></span>
			<input type="email" placeholder="Email" asp-for="SignUpEmail" id="SignUpEmail" />
			<span asp-validation-for="SignUpEmail" class="text-danger"></span>
			<input type="password" placeholder="Password" asp-for="SignUpPassword"/>
			<span asp-validation-for="SignUpPassword" class="text-danger"></span>
			<input type="password" placeholder="Confirm Password" asp-for="SignUpConfirmPassword"/>
			<span asp-validation-for="SignUpConfirmPassword" class="text-danger"></span>
			<button type="submit">Sign Up</button>
		</form>
	</div>
	<div class="form-container sign-in-container">
		<form method="post" asp-action ="SignIn" asp-controller="Authentication">
			<input type="hidden" asp-for="ReturnUrl" />
			<h1>Sign in</h1>
			<div class="social-container">
				<a href="javascript:void(0)" class="social external-login-btn"
				data-provider = "Facebook"
				data-url = "@Url.Action("ExternalLogin","Authentication", new {provider = "Facebook",ReturnUrl = Model.ReturnUrl})">
				<i class="fab fa-facebook-f"></i>
				</a>
				<a href="javascript:void(0)" class="social external-login-btn"
				   data-provider="Google"
				   data-url="@Url.Action("ExternalLogin", "Authentication", new { provider = "Google", ReturnUrl = Model.ReturnUrl })">
				   <i class="fab fa-google-plus-g"></i>
				</a>
				<a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
			</div>
			<span>or use your account</span>
			<input type="email" placeholder="Email" asp-for="SignInEmail" />
			<span asp-validation-for="SignInEmail" class="text-danger"></span>			
			<input type="password" placeholder="Password" asp-for="SignInPassword"/>
			<span asp-validation-for="SignInPassword" class="text-danger"></span>
			@if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
			{
				<span class="alert alert-danger">@ViewBag.ErrorMessage</span>
			}
			<a href="#">Forgot your password?</a>
			<button type="submit">Sign In</button>
		</form>
	</div>
	<div class="overlay-container">
		<div class="overlay">
			<div class="overlay-panel overlay-left">
				<h1>Welcome Back!</h1>
				<p>To keep connected with us please login with your personal info</p>
				<button class="ghost" id="signIn">Sign In</button>
			</div>
			<div class="overlay-panel overlay-right">
				<h1>Hello, Friend!</h1>
				<p>Enter your personal details and start journey with us</p>
				<button class="ghost" id="signUp">Sign Up</button>
			</div>
		</div>
	</div>
</div>

<footer>
	<p>
		Created with <i class="fa fa-heart"></i> by
		<a target="_blank" href="https://florin-pop.com">Florin Pop</a>
		- Read how I created this and how you can join the challenge
		<a target="_blank" href="https://www.florin-pop.com/blog/2019/03/double-slider-sign-in-up-form/">here</a>.
	</p>
</footer>

<script src="~/TemplateLayout/Login/js/JavaScript.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

<script>
	$(document).ready(function () {
		// Thêm phương thức kiểm tra email tồn tại
		$.validator.addMethod("emailExists", function (value, element) {
			var isSuccess = false;
			$.ajax({
				url: "/Authentication/CheckEmailExists", // API kiểm tra email
				type: "POST",
				dataType: "json",
				async: false, // Đảm bảo nhận kết quả trước khi tiếp tục
				data: { email: value },
				success: function (response) {
					isSuccess = response.exists; // Đọc giá trị đúng từ JSON trả về
				},
				error: function () {
					console.error("Lỗi khi gọi API kiểm tra email.");
				}
			});
			return !isSuccess; // Nếu email đã tồn tại, trả về false (không hợp lệ)
		}, "Email đã tồn tại!");

		// Áp dụng kiểm tra vào input email đăng ký
		$("#SignUpEmail").rules("add", {
			emailExists: true
		});
	});

	document.addEventListener("DOMContentLoaded", function () {
		document.querySelectorAll('.external-login-btn').forEach(button => {
			button.addEventListener('click', function (event) {
				event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>

				var provider = this.getAttribute('data-provider');
				var url = this.getAttribute('data-url');

				if (!url) {
					console.error("URL đăng nhập không hợp lệ!");
					return;
				}

				var width = 500, height = 600;
				var left = (window.innerWidth / 2) - (width / 2);
				var top = (window.innerHeight / 2) - (height / 2);

				// Mở cửa sổ popup đăng nhập Google/Facebook
				var popup = window.open(url, provider, `width=${width},height=${height},top=${top},left=${left},resizable=yes`);

				if (!popup) {
					alert("Trình duyệt đã chặn popup. Vui lòng cho phép popup để tiếp tục.");
					return;
				}

				// Kiểm tra nếu popup bị đóng thì reload trang
				var checkPopup = setInterval(function () {
					if (popup.closed) {
						clearInterval(checkPopup);
						location.reload();
					}
				}, 500);
			});
		});
	});
</script>



